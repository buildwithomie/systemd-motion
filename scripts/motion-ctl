#!/usr/bin/env bash
set -euo pipefail

# Systemd Motion Control Script
# Usage: motion-ctl [start|stop|restart|status|enable|disable]

PROJECT_NAME="systemd-motion"
SERVICE_NAME="systemd-motion.service"

case "${1:-status}" in
    start)
        echo "Starting $PROJECT_NAME service..."
        systemctl --user start "$SERVICE_NAME"
        echo "$PROJECT_NAME service started"
        ;;
    stop)
        echo "Stopping $PROJECT_NAME service..."
        systemctl --user stop "$SERVICE_NAME"
        echo "$PROJECT_NAME service stopped"
        ;;
    restart)
        echo "Restarting $PROJECT_NAME service..."
        systemctl --user restart "$SERVICE_NAME"
        echo "$PROJECT_NAME service restarted"
        ;;
    status)
        echo "=== $PROJECT_NAME Service Status ==="
        systemctl --user status "$SERVICE_NAME" --no-pager
        
        echo ""
        echo "=== Recent Session Log ==="
        LOG_FILE="$HOME/.local/state/$PROJECT_NAME/session.log"
        if [ -f "$LOG_FILE" ]; then
            tail -10 "$LOG_FILE"
        else
            echo "No log file found at $LOG_FILE"
        fi
        ;;
    enable)
        echo "Enabling $PROJECT_NAME service for auto-start..."
        systemctl --user enable "$SERVICE_NAME"
        echo "$PROJECT_NAME service enabled"
        ;;
    disable)
        echo "Disabling $PROJECT_NAME service auto-start..."
        systemctl --user disable "$SERVICE_NAME"
        echo "$PROJECT_NAME service disabled"
        ;;
    *)
        echo "Usage: motion-ctl [start|stop|restart|status|enable|disable]"
        echo ""
        echo "Commands:"
        echo "  start    - Start the session service"
        echo "  stop     - Stop the session service"
        echo "  restart  - Restart the session service"
        echo "  status   - Show service status and recent logs"
        echo "  enable   - Enable auto-start on login"
        echo "  disable  - Disable auto-start on login"
        exit 1
        ;;
esac